substitutions:
  name: jk-bms
  pack1_name: "Pack 1"
  pack2_name: "Pack 2"
  addr_pack1: "1"
  addr_pack2: "2"
  modbus_controller_update_interval: "7s"
  bms_control_params_skip_updates: "20"

esphome:
  name: ${name}
  comment: "JK-PB ←RS485→ Atom Lite + ATOMIC RS485 Base"
  min_version: 2025.9.1

esp32:
  board: m5stack-atom # Atom Lite
  framework:
    type: esp-idf

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

api:
  encryption:
    key: !secret jk_bms_api_encryption_key

ota:
  - platform: esphome
    password: !secret jk_bms_ota_password

logger:
  level: DEBUG

uart:
  - id: rs485_uart
    baud_rate: 115200 # JK-PB 115200 8N1
    rx_buffer_size: 384
    tx_pin: GPIO19 # ATOMIC RS485 Base: TX=19
    rx_pin: GPIO22 # ATOMIC RS485 Base: RX=22

modbus:
  - id: rs485
    uart_id: rs485_uart

mqtt:
  broker: !secret mqtt_host
  username: !secret mqtt_username
  password: !secret mqtt_password
  id: mqtt_client

modbus_controller:
  - id: bms1
    address: ${addr_pack1}    # Slave 1
    modbus_id: rs485
    update_interval: ${modbus_controller_update_interval}
    command_throttle: 50ms

  - id: bms2
    address: ${addr_pack2}    # Slave 2
    modbus_id: rs485
    update_interval: ${modbus_controller_update_interval}
    command_throttle: 50ms

# interval:
#   - interval: 5s           # Pack 1 каждые 5 c
#     startup_delay: 1s      # первый запуск через 1 c после boot
#     then:
#       - component.update: bms1

#   - interval: 6.5s         # Pack 2 каждые 6.5 c (не кратно 5 → реже совпадения)
#     startup_delay: 3s      # первый запуск через 3 c после boot
#     then:
#       - component.update: bms2

binary_sensor:
  # Pack 1
  - platform: template
    id: bms1_charging
    name: "${pack1_name} charging"
    lambda: |-
      return id(bms1_charging_raw).state == 1;

  - platform: template
    id: bms1_discharging
    name: "${pack1_name} discharging"
    lambda: |-
      return id(bms1_discharging_raw).state == 1;

  - platform: template
    id: bms1_balancing
    name: "${pack1_name} balancing"
    lambda: |-
      return id(bms1_balancing_raw).state == 1;

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_float_mode
    name: "${pack1_name} charging float mode"
    address: 0x1114
    register_type: holding
    bitmask: 0x0200

  # Pack 2
  - platform: template
    id: bms2_charging
    name: "${pack2_name} charging"
    lambda: |-
      return id(bms2_charging_raw).state == 1;

  - platform: template
    id: bms2_discharging
    name: "${pack2_name} discharging"
    lambda: |-
      return id(bms2_discharging_raw).state == 1;

  - platform: template
    id: bms2_balancing
    name: "${pack2_name} balancing"
    lambda: |-
      return id(bms2_balancing_raw).state == 1;

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_float_mode
    name: "${pack2_name} charging float mode"
    address: 0x1114
    register_type: holding
    bitmask: 0x0200

sensor:
  # Pack 1
  # 0x1000 0 UINT32 4 RW    VolSmartSleep    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_smart_sleep
    name: "${pack1_name} smart sleep"
    address: 0x1000
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1004 4 UINT32 4 RW    VolCellUV       mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_uvp
    name: "${pack1_name} cell UVP"
    address: 0x1004
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1008 8 UINT32 4 RW    VolCellUVPR     mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_uvpr
    name: "${pack1_name} cell UVPR"
    address: 0x1008
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x100C 12  UINT32 4 RW    VolCellOV        mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_ovp
    name: "${pack1_name} cell OVP"
    address: 0x100C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1010 16  UINT32 4 RW    VolCellOVPR      mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_ovpr
    name: "${pack1_name} cell OVPR"
    address: 0x1010
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1014 20  UINT32 4 RW    VolBalanTrig     mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_start_balance_trigger
    name: "${pack1_name} start balance trigger"
    address: 0x1014
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1018 24  UINT32 4 RW    VolSOC100%       mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_soc_100
    name: "${pack1_name} sOC-100%"
    address: 0x1018
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x101C 28  UINT32 4 RW    VolSOC0%         mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_soc_0
    name: "${pack1_name} sOC-0%"
    address: 0x101C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1020 32  UINT32 4 RW    VolCellRCV       mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_rcv
    name: "${pack1_name} cell RCV"
    address: 0x1020
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1024 36  UINT32 4 RW    VolCellRFV       mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_rfv
    name: "${pack1_name} cell RFV"
    address: 0x1024
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1028 40  UINT32 4 RW    VolSysPwrOff     mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_system_power_off
    name: "${pack1_name} system power off"
    address: 0x1028
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x102C 44  UINT32 4 RW    CurBatCOC        mA
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_continued_charge_current
    name: "${pack1_name} continued charge current"
    address: 0x102C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1030 48  UINT32 4 RW    TIMBatCOCPDly    S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_ocp_delay
    name: "${pack1_name} charge OCP delay"
    address: 0x1030
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1034 52  UINT32 4 RW    TIMBatCOCPRDly   S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_ocpr_time
    name: "${pack1_name} charge OCPR time"
    address: 0x1034
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1038 56  UINT32 4 RW    CurBatDcOC       mA
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_continued_discharge_current
    name: "${pack1_name} continued discharge current"
    address: 0x1038
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x103C 60  UINT32 4 RW    TIMBatDcOCPDly   S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_discharge_ocp_delay
    name: "${pack1_name} discharge OCP delay"
    address: 0x103C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1040 64  UINT32 4 RW    TIMBatDcOCPRDly  S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_discharge_ocpr_time
    name: "${pack1_name} discharge OCPR time"
    address: 0x1040
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1044 68  UINT32 4 RW    TIMBatSCPRDly    S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_scpr_time
    name: "${pack1_name} sCPR time"
    address: 0x1044
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1048 72  UINT32 4 RW    CurBalanMax      mA
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_max_balance_current
    name: "${pack1_name} max balance current"
    address: 0x1048
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x104C 76  INT32  4 RW    TMPBatCOT        0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_otp
    name: "${pack1_name} charge OTP"
    address: 0x104C
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1050 80  INT32  4 RW    TMPBatCOTPR      0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_otpr
    name: "${pack1_name} charge OTPR"
    address: 0x1050
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1054 84  INT32  4 RW    TMPBatDcOT       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_discharge_otp
    name: "${pack1_name} discharge OTP"
    address: 0x1054
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1058 88  INT32  4 RW    TMPBatDcOTPR     0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_discharge_otpr
    name: "${pack1_name} discharge OTPR"
    address: 0x1058
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x105C 92  INT32  4 RW    TMPBatCUT        0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_utp
    name: "${pack1_name} charge UTP"
    address: 0x105C
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1060 96  INT32  4 RW    TMPBatCUTPR      0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_utpr
    name: "${pack1_name} charge UTPR"
    address: 0x1060
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1064 100 INT32  4 RW    TMPMosOT         0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_mos_otp
    name: "${pack1_name} mOS OTP"
    address: 0x1064
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1068 104 INT32  4 RW    TMPMosOTPR       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_mos_otpr
    name: "${pack1_name} mOS OTPR"
    address: 0x1068
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x106C 108 UINT32 4 RW    CellCount
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_count
    name: "${pack1_name} cell count"
    address: 0x106C
    register_type: holding
    value_type: U_DWORD
    register_count: 8
    response_size: 8
    skip_updates: ${bms_control_params_skip_updates}
    accuracy_decimals: 0

  # 0x107C 124 UINT32 4 RW    CapBatCell       mAH
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_bat_capacity
    name: "${pack1_name} battery capacity"
    address: 0x107C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: Ah
    device_class: energy_storage
    state_class: measurement
    accuracy_decimals: 0
    filters:
      - multiply: 0.001

  # 0x1080 128 UINT32 4 RW    SCPDelay         us
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_scp_delay
    name: "${pack1_name} sCP delay"
    address: 0x1080
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "uS"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1084 132 UINT32 4 RW    VolStartBalan    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_start_balance
    name: "${pack1_name} start balance"
    address: 0x1084
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

# ----

  # 0x1200    0    UINT16    2    R    CellVol0    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_1
    name: "${pack1_name} cell voltage 1"
    address: 0x1200
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1202    2    UINT16    2    R    CellVol1    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_2
    name: "${pack1_name} cell voltage 2"
    address: 0x1202
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1204    4    UINT16    2    R    CellVol2    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_3
    name: "${pack1_name} cell voltage 3"
    address: 0x1204
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1206    6    UINT16    2    R    CellVol3    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_4
    name: "${pack1_name} cell voltage 4"
    address: 0x1206
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1208    8    UINT16    2    R    CellVol4    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_5
    name: "${pack1_name} cell voltage 5"
    address: 0x1208
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x120A   10    UINT16    2    R    CellVol5    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_6
    name: "${pack1_name} cell voltage 6"
    address: 0x120A
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x120C   12    UINT16    2    R    CellVol6    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_7
    name: "${pack1_name} cell voltage 7"
    address: 0x120C
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x120E   14    UINT16    2    R    CellVol7    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_8
    name: "${pack1_name} cell voltage 8"
    address: 0x120E
    register_type: holding
    value_type: U_WORD
    register_count: 2      # 56  Change to this value if you have 8 cells, otherwise set to 2
    response_size: 2       # 56  Change to this value if you have 8 cells, otherwise set to 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # Comment following part if you have 8 cells,
  # update `register_count` and `response_size` for cell #8 according to the comments

  # 0x1210   16    UINT16    2    R    CellVol8    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_9
    name: "${pack1_name} cell voltage 9"
    address: 0x1210
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1212   18    UINT16    2    R    CellVol9    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_10
    name: "${pack1_name} cell voltage 10"
    address: 0x1212
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1214   20    UINT16    2    R    CellVol10    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_11
    name: "${pack1_name} cell voltage 11"
    address: 0x1214
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1216   22    UINT16    2    R    CellVol11    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_12
    name: "${pack1_name} cell voltage 12"
    address: 0x1216
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1218   24    UINT16    2    R    CellVol12    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_13
    name: "${pack1_name} cell voltage 13"
    address: 0x1218
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x121A   26    UINT16    2    R    CellVol13    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_14
    name: "${pack1_name} cell voltage 14"
    address: 0x121A
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x121C   28    UINT16    2    R    CellVol14    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_15
    name: "${pack1_name} cell voltage 15"
    address: 0x121C
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x121E   30    UINT16    2    R    CellVol15    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_v_16
    name: "${pack1_name} cell voltage 16"
    address: 0x121E
    register_type: holding
    value_type: U_WORD
    register_count: 40
    response_size: 40
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1240   64    UINT32    4    R    CellStatus    (each bit indicates a attached cell)
  # 0x1244   68    UINT16    2    R    CellVolAverage    mV
  # 0x1246   70    UINT16    2    R    CellVoltageDifferenceMax    mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_delta_cell_voltage
    name: "${pack1_name} delta cell voltage"
    address: 0x1246
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1248   72    UINT8/UINT8 2  R    MaxVolCellNbr / MinVolCellNbr
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_max_volt_cell_number
    name: "${pack1_name} max voltage cell number"
    address: 0x1248
    register_type: holding
    value_type: U_WORD
    register_count: 44
    response_size: 44
    unit_of_measurement: ""
    state_class: measurement
    accuracy_decimals: 0
    bitmask: 0xFF00
    filters:
      - offset: 1.0

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_min_volt_cell_number
    name: "${pack1_name} min voltage cell number"
    address: 0x1248
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: ""
    state_class: measurement
    accuracy_decimals: 0
    bitmask: 0x00FF
    filters:
      - offset: 1.0


  # Comment out following part if you don't want monitor wire resistance
  # Comment out Cells 9-16 if you have only 8 cells


  # 0x124A   74    UINT16    2    R    CellWireRes0    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_1_wire_resistance
    name: "${pack1_name} cell 1 wire resistance"
    address: 0x124A
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x124C   76    UINT16    2    R    CellWireRes1    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_2_wire_resistance
    name: "${pack1_name} cell 2 wire resistance"
    address: 0x124C
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x124E   78    UINT16    2    R    CellWireRes2    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_3_wire_resistance
    name: "${pack1_name} cell 3 wire resistance"
    address: 0x124E
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1250   80    UINT16    2    R    CellWireRes3    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_4_wire_resistance
    name: "${pack1_name} cell 4 wire resistance"
    address: 0x1250
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1252   82    UINT16    2    R    CellWireRes4    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_5_wire_resistance
    name: "${pack1_name} cell 5 wire resistance"
    address: 0x1252
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1254   84    UINT16    2    R    CellWireRes5    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_6_wire_resistance
    name: "${pack1_name} cell 6 wire resistance"
    address: 0x1254
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1256   86    UINT16    2    R    CellWireRes6    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_7_wire_resistance
    name: "${pack1_name} cell 7 wire resistance"
    address: 0x1256
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1258   88    UINT16    2    R    CellWireRes7    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_8_wire_resistance
    name: "${pack1_name} cell 8 wire resistance"
    address: 0x1258
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x125A   90    UINT16    2    R    CellWireRes8    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_9_wire_resistance
    name: "${pack1_name} cell 9 wire resistance"
    address: 0x125A
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x125C   92    UINT16    2    R    CellWireRes9    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_10_wire_resistance
    name: "${pack1_name} cell 10 wire resistance"
    address: 0x125C
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x125E   94    UINT16    2    R    CellWireRes10   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_11_wire_resistance
    name: "${pack1_name} cell 11 wire resistance"
    address: 0x125E
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1260   96    UINT16    2    R    CellWireRes11   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_12_wire_resistance
    name: "${pack1_name} cell 12 wire resistance"
    address: 0x1260
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1262   98    UINT16    2    R    CellWireRes12   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_13_wire_resistance
    name: "${pack1_name} cell 13 wire resistance"
    address: 0x1262
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1264   100   UINT16    2    R    CellWireRes13   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_14_wire_resistance
    name: "${pack1_name} cell 14 wire resistance"
    address: 0x1264
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1266   102   UINT16    2    R    CellWireRes14   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_15_wire_resistance
    name: "${pack1_name} cell 15 wire resistance"
    address: 0x1266
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1268   104   UINT16    2    R    CellWireRes15   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cell_16_wire_resistance
    name: "${pack1_name} cell 16 wire resistance"
    address: 0x1268
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001


  # 0x128A   138    INT16    2    R    TempMos         0.1 °C
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_mosfet_temperature
    name: "${pack1_name} mosfet temperature"
    address: 0x128A
    register_type: holding
    value_type: S_WORD
    register_count: 6
    response_size: 6
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.1

  # 0x128C   140   UINT32    4    R    CellWireResSta  Bit per Cell
  # 0x1290   144   UINT32    4    R    BatVol          mV
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_total_voltage
    name: "${pack1_name} total voltage"
    address: 0x1290
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1294   148   UINT32    4    R    BatWatt         mW
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_power
    name: "${pack1_name} power"
    address: 0x1294
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - lambda: |-
          return id(bms1_current).state < 0
            ? x * -1
            : x;
      - multiply: 0.001

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_power
    name: "${pack1_name} charging power"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001
      - lambda: |-
          if (x > 0.0f && !isnan(id(bms1_total_voltage).state)) {
            return x * id(bms1_total_voltage).state;
          }
          return 0.0f;

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_discharge_power
    name: "${pack1_name} discharging power"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001
      - lambda: |-
          if (x < 0.0f && !isnan(id(bms1_total_voltage).state)) {
            return abs(x) * id(bms1_total_voltage).state;
          }
          return 0.0f;

  # 0x1298   152    INT32    4    R    BatCurrent      mA
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_current
    name: "${pack1_name} current"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_current
    name: "${pack1_name} charging current"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001
      - lambda: |-
          if (x > 0.0f) {
            return x;
          }
          return 0.0f;

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_discharge_current
    name: "${pack1_name} discharging current"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001
      - lambda: |-
          if (x < 0.0f) {
            return abs(x);
          }
          return 0.0f;

  # 0x129C   156    INT16    2    R    TempBat 1       0.1 °C
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_temp_sens_1
    name: "${pack1_name} temperature sensor 1"
    address: 0x129C
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x129E   158    INT16    2    R    TempBat 2       0.1 °C
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_temp_sens_2
    name: "${pack1_name} temperature sensor 2"
    address: 0x129E
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x12A0   160   UINT32    4    R    AlarmBitmask
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_alarms_bitmask
    name: "${pack1_name} alarms bitmask"
    address: 0x12A0
    register_type: holding
    value_type: U_DWORD
    register_count: 2
    response_size: 4
    disabled_by_default: true
    on_value:
      - component.update: bms1_alarms

  # 0x12A4   164    INT16    2    R    BalanCurrent    mA
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_balance_current
    name: "${pack1_name} balance current"
    address: 0x12A4
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001

  # 0x12A6   166 UINT8+UINT8 2    R    BalanStatatus (2:放电; 1:充电 ; 0:关闭) / SOCStateOfcharge %
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_state_of_charge
    name: "${pack1_name} state of charge"
    address: 0x12A6
    register_type: holding
    value_type: U_WORD
    state_class: measurement
    device_class: battery
    unit_of_measurement: "%"
    accuracy_decimals: 0
    bitmask: 0x00FF

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_balancing_raw
    address: 0x12A6
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    disabled_by_default: true
    bitmask: 0x01

  # 0x12A8   168    INT32    2    R    SOCCapRemain    mAH
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_cap_rem_derived
    name: "${pack1_name} capacity remaining derived"
    address: 0x12A8
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    state_class: measurement
    device_class: energy_storage
    unit_of_measurement: "Ah"
    accuracy_decimals: 0
    filters:
      - multiply: 0.001

  # 0x12AC   172   UINT32    4    R    SOCFullChargeCap    mAH
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_actual_bat_capacity
    name: "${pack1_name} actual battery capacity"
    address: 0x12AC
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    state_class: measurement
    device_class: energy_storage
    unit_of_measurement: "Ah"
    accuracy_decimals: 0
    filters:
      - multiply: 0.001

  # 0x12B0   176   UINT32    4    R    SOCCycleCount   次
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_cycles
    name: "${pack1_name} charging cycles"
    address: 0x12B0
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    state_class: measurement
    accuracy_decimals: 0

  # 0x12B4   180   UINT32    4    R    SOCCycleCap     mAH
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_total_charge_cycle_capacity
    name: "${pack1_name} total charging cycle capacity"
    address: 0x12B4
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    state_class: measurement
    unit_of_measurement: "Ah"
    accuracy_decimals: 0
    filters:
      - multiply: 0.001

  # 0x12B8   184 UINT8+UINT8 2    R    StateOfHealth % / Precharge stats (1:打开 ; 0:关闭)
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_state_of_health
    name: "${pack1_name} state of health"
    address: 0x12B8
    register_type: holding
    value_type: U_WORD
    register_count: 4
    response_size: 4
    state_class: measurement
    unit_of_measurement: "%"
    accuracy_decimals: 0
    lambda: |-
      return data[item->offset];

  # 0x12BA   186   UINT16    2    R    UserAlarm

  # 0x12BC   188   UINT32    4    R    RunTime         S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_total_runtime
    name: "${pack1_name} total runtime in seconds"
    address: 0x12BC
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12C0   192 UINT8+UINT8 Charge (1:打开 ; 0:关闭) / Discharge (1:打开 ; 0:关闭)
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charging_raw
    address: 0x12C0
    register_type: holding
    value_type: U_WORD
    register_count: 4
    response_size: 4
    disabled_by_default: true
    bitmask: 0x0001

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_discharging_raw
    address: 0x12C0
    register_type: holding
    value_type: U_WORD
    register_count: 4
    response_size: 4
    disabled_by_default: true
    bitmask: 0x0100

  # 0x12C2   194   UINT16    2    R    UserAlarm2
  # - platform: modbus_controller
  #   modbus_controller_id: bms1
  #   name: "UserAlarm2 Status"
  #   address: 0x12C2
  #   register_type: holding
  #   value_type: U_WORD
  #   register_count: 2
  #   response_size: 2
  #   state_class: measurement
  #   accuracy_decimals: 0

  # 0x12C4   196   UINT16    2    R    TimeDcOCPR      S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_disacharge_ocpr_left
    name: "${pack1_name} disacharge OCPR left"
    address: 0x12C4
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12C6   198   UINT16    2    R    TimeDcSCPR      S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_disacharge_scpr_left
    name: "${pack1_name} disacharge SCPR left"
    address: 0x12C6
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    state_class: measurement
    accuracy_decimals: 0

  # 0x12C8   200   UINT16    2    R    TimeCOCPR       S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_ocpr_left
    name: "${pack1_name} charge OCPR left"
    address: 0x12C8
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12CA   202   UINT16    2    R    TimeCSCPR       S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charge_scpr_left
    name: "${pack1_name} charge SCPR left"
    address: 0x12CA
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12CC   204   UINT16    2    R    TimeUVPR        S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_uvpr_left
    name: "${pack1_name} uVPR left"
    address: 0x12CC
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12CE   206   UINT16    2    R    TimeOVPR        S
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_ovpr_left
    name: "${pack1_name} oVPR left"
    address: 0x12CE
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12D0   208 UINT8+UINT8 2    R    AbsentBitmask (Bit0: MOS TempSensorAbsent, Bit1: BATTempSensor1Absent, Bit2: BATTempSensor2Absent, Bit4: BATTempSensor4Absent, Bit5: BATTempSensor5Absent) / Heating
  # 0x12D2   210   UINT16    2    R    Reserved
  # 0x12D4   212   UINT16    2    R    TimeEmergency   S
  # 0x12D6   214   UINT16    2    R    BatCurCorrect
  # 0x12D8   216   UINT16    2    R    VolChargCur     mV
  # 0x12DA   218   UINT16    2    R    VolDischargCur  mV
  # 0x12DC   214   FLOAT     4    R    BatVolCorrect
  # 0x12E4   228   UINT16    2    R    BatVol          0.01V
  # 0x12E6   230   INT16     2    R    HeatCurrent     mA
  # 0x12F0   240   UINT32    4    R    SysRunTicks     0.1S

  # 0x12F8   248   INT16     2    R    TempBat 3       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_temp_sens_3
    name: "${pack1_name} temperature sensor 3"
    address: 0x12F8
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x12FA   248   INT16     2    R    TempBat 4       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_temp_sens_4
    name: "${pack1_name} temperature sensor 4"
    address: 0x12FA
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x12FC   248   INT16     2    R    TempBat 5       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_jkbms_bat_temp4
    name: "${pack1_name} temperature sensor 5"
    address: 0x12FC
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

# ----

  # 0x1504   260 UINT8+UINT8 2    RW    RCV Time / RFV Time 0.1 H
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_rcv_time
    name: "${pack1_name} rCV Time"
    address: 0x1504
    register_type: holding
    value_type: U_WORD
    register_count: 1
    response_size: 1
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "h"
    device_class: duration
    state_class: measurement
    bitmask: 0xFF
    filters:
      - multiply: 0.1

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_rfv_time
    name: "${pack1_name} rFV Time"
    address: 0x1504
    register_type: holding
    value_type: U_WORD
    register_count: 1
    response_size: 1
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "h"
    device_class: duration
    state_class: measurement
    bitmask: 0xFF00
    filters:
      - multiply: 0.1

  # Pack 2
  # 0x1000 0 UINT32 4 RW    VolSmartSleep    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_smart_sleep
    name: "${pack2_name} smart sleep"
    address: 0x1000
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1004 4 UINT32 4 RW    VolCellUV       mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_uvp
    name: "${pack2_name} cell UVP"
    address: 0x1004
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1008 8 UINT32 4 RW    VolCellUVPR     mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_uvpr
    name: "${pack2_name} cell UVPR"
    address: 0x1008
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x100C 12  UINT32 4 RW    VolCellOV        mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_ovp
    name: "${pack2_name} cell OVP"
    address: 0x100C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1010 16  UINT32 4 RW    VolCellOVPR      mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_ovpr
    name: "${pack2_name} cell OVPR"
    address: 0x1010
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1014 20  UINT32 4 RW    VolBalanTrig     mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_start_balance_trigger
    name: "${pack2_name} start balance trigger"
    address: 0x1014
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1018 24  UINT32 4 RW    VolSOC100%       mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_soc_100
    name: "${pack2_name} sOC-100%"
    address: 0x1018
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x101C 28  UINT32 4 RW    VolSOC0%         mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_soc_0
    name: "${pack2_name} sOC-0%"
    address: 0x101C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1020 32  UINT32 4 RW    VolCellRCV       mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_rcv
    name: "${pack2_name} cell RCV"
    address: 0x1020
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1024 36  UINT32 4 RW    VolCellRFV       mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_rfv
    name: "${pack2_name} cell RFV"
    address: 0x1024
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1028 40  UINT32 4 RW    VolSysPwrOff     mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_system_power_off
    name: "${pack2_name} system power off"
    address: 0x1028
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x102C 44  UINT32 4 RW    CurBatCOC        mA
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_continued_charge_current
    name: "${pack2_name} continued charge current"
    address: 0x102C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1030 48  UINT32 4 RW    TIMBatCOCPDly    S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_ocp_delay
    name: "${pack2_name} charge OCP delay"
    address: 0x1030
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1034 52  UINT32 4 RW    TIMBatCOCPRDly   S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_ocpr_time
    name: "${pack2_name} charge OCPR time"
    address: 0x1034
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1038 56  UINT32 4 RW    CurBatDcOC       mA
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_continued_discharge_current
    name: "${pack2_name} continued discharge current"
    address: 0x1038
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x103C 60  UINT32 4 RW    TIMBatDcOCPDly   S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_discharge_ocp_delay
    name: "${pack2_name} discharge OCP delay"
    address: 0x103C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1040 64  UINT32 4 RW    TIMBatDcOCPRDly  S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_discharge_ocpr_time
    name: "${pack2_name} discharge OCPR time"
    address: 0x1040
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1044 68  UINT32 4 RW    TIMBatSCPRDly    S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_scpr_time
    name: "${pack2_name} sCPR time"
    address: 0x1044
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1048 72  UINT32 4 RW    CurBalanMax      mA
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_max_balance_current
    name: "${pack2_name} max balance current"
    address: 0x1048
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001

  # 0x104C 76  INT32  4 RW    TMPBatCOT        0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_otp
    name: "${pack2_name} charge OTP"
    address: 0x104C
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1050 80  INT32  4 RW    TMPBatCOTPR      0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_otpr
    name: "${pack2_name} charge OTPR"
    address: 0x1050
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1054 84  INT32  4 RW    TMPBatDcOT       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_discharge_otp
    name: "${pack2_name} discharge OTP"
    address: 0x1054
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1058 88  INT32  4 RW    TMPBatDcOTPR     0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_discharge_otpr
    name: "${pack2_name} discharge OTPR"
    address: 0x1058
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x105C 92  INT32  4 RW    TMPBatCUT        0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_utp
    name: "${pack2_name} charge UTP"
    address: 0x105C
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1060 96  INT32  4 RW    TMPBatCUTPR      0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_utpr
    name: "${pack2_name} charge UTPR"
    address: 0x1060
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1064 100 INT32  4 RW    TMPMosOT         0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_mos_otp
    name: "${pack2_name} mOS OTP"
    address: 0x1064
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x1068 104 INT32  4 RW    TMPMosOTPR       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_mos_otpr
    name: "${pack2_name} mOS OTPR"
    address: 0x1068
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x106C 108 UINT32 4 RW    CellCount
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_count
    name: "${pack2_name} cell count"
    address: 0x106C
    register_type: holding
    value_type: U_DWORD
    register_count: 8
    response_size: 8
    skip_updates: ${bms_control_params_skip_updates}
    accuracy_decimals: 0

  # 0x107C 124 UINT32 4 RW    CapBatCell       mAH
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_bat_capacity
    name: "${pack2_name} battery capacity"
    address: 0x107C
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: Ah
    device_class: energy_storage
    state_class: measurement
    accuracy_decimals: 0
    filters:
      - multiply: 0.001

  # 0x1080 128 UINT32 4 RW    SCPDelay         us
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_scp_delay
    name: "${pack2_name} sCP delay"
    address: 0x1080
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "uS"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x1084 132 UINT32 4 RW    VolStartBalan    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_start_balance
    name: "${pack2_name} start balance"
    address: 0x1084
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

# ----

  # 0x1200    0    UINT16    2    R    CellVol0    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_1
    name: "${pack2_name} cell voltage 1"
    address: 0x1200
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1202    2    UINT16    2    R    CellVol1    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_2
    name: "${pack2_name} cell voltage 2"
    address: 0x1202
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1204    4    UINT16    2    R    CellVol2    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_3
    name: "${pack2_name} cell voltage 3"
    address: 0x1204
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1206    6    UINT16    2    R    CellVol3    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_4
    name: "${pack2_name} cell voltage 4"
    address: 0x1206
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1208    8    UINT16    2    R    CellVol4    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_5
    name: "${pack2_name} cell voltage 5"
    address: 0x1208
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x120A   10    UINT16    2    R    CellVol5    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_6
    name: "${pack2_name} cell voltage 6"
    address: 0x120A
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x120C   12    UINT16    2    R    CellVol6    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_7
    name: "${pack2_name} cell voltage 7"
    address: 0x120C
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x120E   14    UINT16    2    R    CellVol7    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_8
    name: "${pack2_name} cell voltage 8"
    address: 0x120E
    register_type: holding
    value_type: U_WORD
    register_count: 2      # 56  Change to this value if you have 8 cells, otherwise set to 2
    response_size: 2       # 56  Change to this value if you have 8 cells, otherwise set to 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # Comment following part if you have 8 cells,
  # update `register_count` and `response_size` for cell #8 according to the comments

  # 0x1210   16    UINT16    2    R    CellVol8    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_9
    name: "${pack2_name} cell voltage 9"
    address: 0x1210
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1212   18    UINT16    2    R    CellVol9    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_10
    name: "${pack2_name} cell voltage 10"
    address: 0x1212
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1214   20    UINT16    2    R    CellVol10    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_11
    name: "${pack2_name} cell voltage 11"
    address: 0x1214
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1216   22    UINT16    2    R    CellVol11    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_12
    name: "${pack2_name} cell voltage 12"
    address: 0x1216
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1218   24    UINT16    2    R    CellVol12    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_13
    name: "${pack2_name} cell voltage 13"
    address: 0x1218
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x121A   26    UINT16    2    R    CellVol13    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_14
    name: "${pack2_name} cell voltage 14"
    address: 0x121A
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x121C   28    UINT16    2    R    CellVol14    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_15
    name: "${pack2_name} cell voltage 15"
    address: 0x121C
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x121E   30    UINT16    2    R    CellVol15    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_v_16
    name: "${pack2_name} cell voltage 16"
    address: 0x121E
    register_type: holding
    value_type: U_WORD
    register_count: 40
    response_size: 40
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1240   64    UINT32    4    R    CellStatus    (each bit indicates a attached cell)
  # 0x1244   68    UINT16    2    R    CellVolAverage    mV
  # 0x1246   70    UINT16    2    R    CellVoltageDifferenceMax    mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_delta_cell_voltage
    name: "${pack2_name} delta cell voltage"
    address: 0x1246
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1248   72    UINT8/UINT8 2  R    MaxVolCellNbr / MinVolCellNbr
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_max_volt_cell_number
    name: "${pack2_name} max voltage cell number"
    address: 0x1248
    register_type: holding
    value_type: U_WORD
    register_count: 44
    response_size: 44
    unit_of_measurement: ""
    state_class: measurement
    accuracy_decimals: 0
    bitmask: 0xFF00
    filters:
      - offset: 1.0

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_min_volt_cell_number
    name: "${pack2_name} min voltage cell number"
    address: 0x1248
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: ""
    state_class: measurement
    accuracy_decimals: 0
    bitmask: 0x00FF
    filters:
      - offset: 1.0


  # Comment out following part if you don't want monitor wire resistance
  # Comment out Cells 9-16 if you have only 8 cells


  # 0x124A   74    UINT16    2    R    CellWireRes0    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_1_wire_resistance
    name: "${pack2_name} cell 1 wire resistance"
    address: 0x124A
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x124C   76    UINT16    2    R    CellWireRes1    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_2_wire_resistance
    name: "${pack2_name} cell 2 wire resistance"
    address: 0x124C
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x124E   78    UINT16    2    R    CellWireRes2    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_3_wire_resistance
    name: "${pack2_name} cell 3 wire resistance"
    address: 0x124E
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1250   80    UINT16    2    R    CellWireRes3    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_4_wire_resistance
    name: "${pack2_name} cell 4 wire resistance"
    address: 0x1250
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1252   82    UINT16    2    R    CellWireRes4    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_5_wire_resistance
    name: "${pack2_name} cell 5 wire resistance"
    address: 0x1252
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1254   84    UINT16    2    R    CellWireRes5    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_6_wire_resistance
    name: "${pack2_name} cell 6 wire resistance"
    address: 0x1254
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1256   86    UINT16    2    R    CellWireRes6    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_7_wire_resistance
    name: "${pack2_name} cell 7 wire resistance"
    address: 0x1256
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1258   88    UINT16    2    R    CellWireRes7    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_8_wire_resistance
    name: "${pack2_name} cell 8 wire resistance"
    address: 0x1258
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x125A   90    UINT16    2    R    CellWireRes8    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_9_wire_resistance
    name: "${pack2_name} cell 9 wire resistance"
    address: 0x125A
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x125C   92    UINT16    2    R    CellWireRes9    mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_10_wire_resistance
    name: "${pack2_name} cell 10 wire resistance"
    address: 0x125C
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x125E   94    UINT16    2    R    CellWireRes10   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_11_wire_resistance
    name: "${pack2_name} cell 11 wire resistance"
    address: 0x125E
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1260   96    UINT16    2    R    CellWireRes11   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_12_wire_resistance
    name: "${pack2_name} cell 12 wire resistance"
    address: 0x1260
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1262   98    UINT16    2    R    CellWireRes12   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_13_wire_resistance
    name: "${pack2_name} cell 13 wire resistance"
    address: 0x1262
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1264   100   UINT16    2    R    CellWireRes13   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_14_wire_resistance
    name: "${pack2_name} cell 14 wire resistance"
    address: 0x1264
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1266   102   UINT16    2    R    CellWireRes14   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_15_wire_resistance
    name: "${pack2_name} cell 15 wire resistance"
    address: 0x1266
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1268   104   UINT16    2    R    CellWireRes15   mΩ
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cell_16_wire_resistance
    name: "${pack2_name} cell 16 wire resistance"
    address: 0x1268
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "Ω"
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001


  # 0x128A   138    INT16    2    R    TempMos         0.1 °C
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_mosfet_temperature
    name: "${pack2_name} mosfet temperature"
    address: 0x128A
    register_type: holding
    value_type: S_WORD
    register_count: 6
    response_size: 6
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.1

  # 0x128C   140   UINT32    4    R    CellWireResSta  Bit per Cell
  # 0x1290   144   UINT32    4    R    BatVol          mV
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_total_voltage
    name: "${pack2_name} total voltage"
    address: 0x1290
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "V"
    device_class: voltage
    state_class: measurement
    accuracy_decimals: 3
    filters:
      - multiply: 0.001

  # 0x1294   148   UINT32    4    R    BatWatt         mW
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_power
    name: "${pack2_name} power"
    address: 0x1294
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - lambda: |-
          return id(bms2_current).state < 0
            ? x * -1
            : x;
      - multiply: 0.001

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_power
    name: "${pack2_name} charging power"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001
      - lambda: |-
          if (x > 0.0f && !isnan(id(bms2_total_voltage).state)) {
            return x * id(bms2_total_voltage).state;
          }
          return 0.0f;

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_discharge_power
    name: "${pack2_name} discharging power"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "W"
    device_class: power
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001
      - lambda: |-
          if (x < 0.0f && !isnan(id(bms2_total_voltage).state)) {
            return abs(x) * id(bms2_total_voltage).state;
          }
          return 0.0f;

  # 0x1298   152    INT32    4    R    BatCurrent      mA
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_current
    name: "${pack2_name} current"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_current
    name: "${pack2_name} charging current"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001
      - lambda: |-
          if (x > 0.0f) {
            return x;
          }
          return 0.0f;

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_discharge_current
    name: "${pack2_name} discharging current"
    address: 0x1298
    register_type: holding
    value_type: S_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    accuracy_decimals: 2
    filters:
      - multiply: 0.001
      - lambda: |-
          if (x < 0.0f) {
            return abs(x);
          }
          return 0.0f;

  # 0x129C   156    INT16    2    R    TempBat 1       0.1 °C
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_temp_sens_1
    name: "${pack2_name} temperature sensor 1"
    address: 0x129C
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x129E   158    INT16    2    R    TempBat 2       0.1 °C
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_temp_sens_2
    name: "${pack2_name} temperature sensor 2"
    address: 0x129E
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x12A0   160   UINT32    4    R    AlarmBitmask
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_alarms_bitmask
    name: "${pack2_name} alarms bitmask"
    address: 0x12A0
    register_type: holding
    value_type: U_DWORD
    register_count: 2
    response_size: 4
    disabled_by_default: true
    on_value:
      - component.update: bms2_alarms

  # 0x12A4   164    INT16    2    R    BalanCurrent    mA
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_balance_current
    name: "${pack2_name} balance current"
    address: 0x12A4
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "A"
    device_class: current
    state_class: measurement
    # accuracy_decimals: 2
    # filters:
    #   - multiply: 0.001

  # 0x12A6   166 UINT8+UINT8 2    R    BalanStatatus (2:放电; 1:充电 ; 0:关闭) / SOCStateOfcharge %
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_state_of_charge
    name: "${pack2_name} state of charge"
    address: 0x12A6
    register_type: holding
    value_type: U_WORD
    state_class: measurement
    device_class: battery
    unit_of_measurement: "%"
    accuracy_decimals: 0
    bitmask: 0x00FF

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_balancing_raw
    address: 0x12A6
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    disabled_by_default: true
    bitmask: 0x01

  # 0x12A8   168    INT32    2    R    SOCCapRemain    mAH
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_cap_rem_derived
    name: "${pack2_name} capacity remaining derived"
    address: 0x12A8
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    state_class: measurement
    device_class: energy_storage
    unit_of_measurement: "Ah"
    accuracy_decimals: 0
    filters:
      - multiply: 0.001

  # 0x12AC   172   UINT32    4    R    SOCFullChargeCap    mAH
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_actual_bat_capacity
    name: "${pack2_name} actual battery capacity"
    address: 0x12AC
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    state_class: measurement
    device_class: energy_storage
    unit_of_measurement: "Ah"
    accuracy_decimals: 0
    filters:
      - multiply: 0.001

  # 0x12B0   176   UINT32    4    R    SOCCycleCount   次
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_cycles
    name: "${pack2_name} charging cycles"
    address: 0x12B0
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    state_class: measurement
    accuracy_decimals: 0

  # 0x12B4   180   UINT32    4    R    SOCCycleCap     mAH
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_total_charge_cycle_capacity
    name: "${pack2_name} total charging cycle capacity"
    address: 0x12B4
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    state_class: measurement
    unit_of_measurement: "Ah"
    accuracy_decimals: 0
    filters:
      - multiply: 0.001

  # 0x12B8   184 UINT8+UINT8 2    R    StateOfHealth % / Precharge stats (1:打开 ; 0:关闭)
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_state_of_health
    name: "${pack2_name} state of health"
    address: 0x12B8
    register_type: holding
    value_type: U_WORD
    register_count: 4
    response_size: 4
    state_class: measurement
    unit_of_measurement: "%"
    accuracy_decimals: 0
    lambda: |-
      return data[item->offset];

  # 0x12BA   186   UINT16    2    R    UserAlarm

  # 0x12BC   188   UINT32    4    R    RunTime         S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_total_runtime
    name: "${pack2_name} total runtime in seconds"
    address: 0x12BC
    register_type: holding
    value_type: U_DWORD
    register_count: 4
    response_size: 4
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12C0   192 UINT8+UINT8 Charge (1:打开 ; 0:关闭) / Discharge (1:打开 ; 0:关闭)
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charging_raw
    address: 0x12C0
    register_type: holding
    value_type: U_WORD
    register_count: 4
    response_size: 4
    disabled_by_default: true
    bitmask: 0x0001

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_discharging_raw
    address: 0x12C0
    register_type: holding
    value_type: U_WORD
    register_count: 4
    response_size: 4
    disabled_by_default: true
    bitmask: 0x0100

  # 0x12C2   194   UINT16    2    R    UserAlarm2
  # - platform: modbus_controller
  #   modbus_controller_id: bms2
  #   name: "UserAlarm2 Status"
  #   address: 0x12C2
  #   register_type: holding
  #   value_type: U_WORD
  #   register_count: 2
  #   response_size: 2
  #   state_class: measurement
  #   accuracy_decimals: 0

  # 0x12C4   196   UINT16    2    R    TimeDcOCPR      S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_disacharge_ocpr_left
    name: "${pack2_name} disacharge OCPR left"
    address: 0x12C4
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12C6   198   UINT16    2    R    TimeDcSCPR      S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_disacharge_scpr_left
    name: "${pack2_name} disacharge SCPR left"
    address: 0x12C6
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    state_class: measurement
    accuracy_decimals: 0

  # 0x12C8   200   UINT16    2    R    TimeCOCPR       S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_ocpr_left
    name: "${pack2_name} charge OCPR left"
    address: 0x12C8
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12CA   202   UINT16    2    R    TimeCSCPR       S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charge_scpr_left
    name: "${pack2_name} charge SCPR left"
    address: 0x12CA
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12CC   204   UINT16    2    R    TimeUVPR        S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_uvpr_left
    name: "${pack2_name} uVPR left"
    address: 0x12CC
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12CE   206   UINT16    2    R    TimeOVPR        S
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_ovpr_left
    name: "${pack2_name} oVPR left"
    address: 0x12CE
    register_type: holding
    value_type: U_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "s"
    device_class: duration
    state_class: measurement
    accuracy_decimals: 0

  # 0x12D0   208 UINT8+UINT8 2    R    AbsentBitmask (Bit0: MOS TempSensorAbsent, Bit1: BATTempSensor1Absent, Bit2: BATTempSensor2Absent, Bit4: BATTempSensor4Absent, Bit5: BATTempSensor5Absent) / Heating
  # 0x12D2   210   UINT16    2    R    Reserved
  # 0x12D4   212   UINT16    2    R    TimeEmergency   S
  # 0x12D6   214   UINT16    2    R    BatCurCorrect
  # 0x12D8   216   UINT16    2    R    VolChargCur     mV
  # 0x12DA   218   UINT16    2    R    VolDischargCur  mV
  # 0x12DC   214   FLOAT     4    R    BatVolCorrect
  # 0x12E4   228   UINT16    2    R    BatVol          0.01V
  # 0x12E6   230   INT16     2    R    HeatCurrent     mA
  # 0x12F0   240   UINT32    4    R    SysRunTicks     0.1S

  # 0x12F8   248   INT16     2    R    TempBat 3       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_temp_sens_3
    name: "${pack2_name} temperature sensor 3"
    address: 0x12F8
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x12FA   248   INT16     2    R    TempBat 4       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_temp_sens_4
    name: "${pack2_name} temperature sensor 4"
    address: 0x12FA
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

  # 0x12FC   248   INT16     2    R    TempBat 5       0.1℃
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_jkbms_bat_temp4
    name: "${pack2_name} temperature sensor 5"
    address: 0x12FC
    register_type: holding
    value_type: S_WORD
    register_count: 2
    response_size: 2
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
    filters:
      - multiply: 0.1

# ----

  # 0x1504   260 UINT8+UINT8 2    RW    RCV Time / RFV Time 0.1 H
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_rcv_time
    name: "${pack2_name} rCV Time"
    address: 0x1504
    register_type: holding
    value_type: U_WORD
    register_count: 1
    response_size: 1
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "h"
    device_class: duration
    state_class: measurement
    bitmask: 0xFF
    filters:
      - multiply: 0.1

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_rfv_time
    name: "${pack2_name} rFV Time"
    address: 0x1504
    register_type: holding
    value_type: U_WORD
    register_count: 1
    response_size: 1
    skip_updates: ${bms_control_params_skip_updates}
    unit_of_measurement: "h"
    device_class: duration
    state_class: measurement
    bitmask: 0xFF00
    filters:
      - multiply: 0.1

select:
  # Pack 1
  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_charging_toggle
    name: "${pack1_name} charging"
    icon: "mdi:battery-charging-100"
    address: 0x1070
    value_type: U_DWORD
    skip_updates: 5
    optionsmap:
      "Off": 0
      "On": 1

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_discharging_toggle
    name: "${pack1_name} discharging"
    icon: "mdi:power-plug-battery"
    address: 0x1074
    value_type: U_DWORD
    skip_updates: 5
    optionsmap:
      "Off": 0
      "On": 1

  - platform: modbus_controller
    modbus_controller_id: bms1
    id: bms1_balancing_toggle
    name: "${pack1_name} balancing"
    icon: mdi:scale-balance
    address: 0x1078
    value_type: U_DWORD
    skip_updates: 5
    optionsmap:
      "Off": 0
      "On": 1
  # Pack 2
  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_charging_toggle
    name: "${pack2_name} charging"
    icon: "mdi:battery-charging-100"
    address: 0x1070
    value_type: U_DWORD
    skip_updates: 5
    optionsmap:
      "Off": 0
      "On": 1

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_discharging_toggle
    name: "${pack2_name} discharging"
    icon: "mdi:power-plug-battery"
    address: 0x1074
    value_type: U_DWORD
    skip_updates: 5
    optionsmap:
      "Off": 0
      "On": 1

  - platform: modbus_controller
    modbus_controller_id: bms2
    id: bms2_balancing_toggle
    name: "${pack2_name} balancing"
    icon: mdi:scale-balance
    address: 0x1078
    value_type: U_DWORD
    skip_updates: 5
    optionsmap:
      "Off": 0
      "On": 1

text_sensor:
  # Pack 1
  - platform: template
    name: "${pack1_name} total runtime formatted"
    update_interval: 60s
    lambda: |-
      std::string value = "Unknown";
      if (id(bms1_total_runtime) && !isnan(id(bms1_total_runtime).state)) {
        uint32_t seconds = (uint32_t) id(bms1_total_runtime).state;
        uint32_t years = seconds / (24 * 3600 * 365);
        seconds = seconds % (24 * 3600 * 365);
        uint32_t days = seconds / (24 * 3600);
        seconds = seconds % (24 * 3600);
        uint32_t hours = seconds / 3600;
        value = (years ? to_string(years) + "y " : "") + (days ? to_string(days) + "d " : "") +
                (hours ? to_string(hours) + "h" : "");
      }
      return value;

  - platform: template
    id: bms1_alarms
    name: "${pack1_name} alarms"
    update_interval: never
    lambda: |-
      static const uint8_t alarms_size = 22;
      static const char *const alarms[alarms_size] = {
        "Wire resistance",
        "MOS OTP",
        "Cell quantity",
        "Current sensor error",
        "Cell OVP",
        "Battery OVP",
        "Charge OCP",
        "Charge SCP",
        "Charge OTP",
        "Charge UTP",
        "CPU Aux comm error",
        "Cell UVP",
        "Batt UVP",
        "Discharge OCP",
        "Discharge SCP",
        "Discharge OTP",
        "Charge MOS",
        "Discharge MOS",
        "GPS Disconnected",
        "Modify PWD. in time",
        "Discharge On Failed",
        "Battery Over Temp Alarm"
      };
      std::string values = "";
      uint32_t mask = id(bms1_alarms_bitmask)->state;
      if (mask) {
        for (int i = 0; i < alarms_size; i++) {
          if (mask & (1 << i)) {
            values.append(alarms[i]);
            values.append("; ");
          }
        }
        if (!values.empty()) {
          values.pop_back();
        }
      }
      return values;
  # Pack 2
  - platform: template
    name: "${pack2_name} total runtime formatted"
    update_interval: 60s
    lambda: |-
      std::string value = "Unknown";
      if (id(bms2_total_runtime) && !isnan(id(bms2_total_runtime).state)) {
        uint32_t seconds = (uint32_t) id(bms2_total_runtime).state;
        uint32_t years = seconds / (24 * 3600 * 365);
        seconds = seconds % (24 * 3600 * 365);
        uint32_t days = seconds / (24 * 3600);
        seconds = seconds % (24 * 3600);
        uint32_t hours = seconds / 3600;
        value = (years ? to_string(years) + "y " : "") + (days ? to_string(days) + "d " : "") +
                (hours ? to_string(hours) + "h" : "");
      }
      return value;

  - platform: template
    id: bms2_alarms
    name: "${pack2_name} alarms"
    update_interval: never
    lambda: |-
      static const uint8_t alarms_size = 22;
      static const char *const alarms[alarms_size] = {
        "Wire resistance",
        "MOS OTP",
        "Cell quantity",
        "Current sensor error",
        "Cell OVP",
        "Battery OVP",
        "Charge OCP",
        "Charge SCP",
        "Charge OTP",
        "Charge UTP",
        "CPU Aux comm error",
        "Cell UVP",
        "Batt UVP",
        "Discharge OCP",
        "Discharge SCP",
        "Discharge OTP",
        "Charge MOS",
        "Discharge MOS",
        "GPS Disconnected",
        "Modify PWD. in time",
        "Discharge On Failed",
        "Battery Over Temp Alarm"
      };
      std::string values = "";
      uint32_t mask = id(bms2_alarms_bitmask)->state;
      if (mask) {
        for (int i = 0; i < alarms_size; i++) {
          if (mask & (1 << i)) {
            values.append(alarms[i]);
            values.append("; ");
          }
        }
        if (!values.empty()) {
          values.pop_back();
        }
      }
      return values;